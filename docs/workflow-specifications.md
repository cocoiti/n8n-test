# ワークフロー仕様書作成ガイド

n8nワークフローの仕様を体系的に管理するためのガイドです。要件定義から実装まで一貫した文書化を行い、Claude Codeでの効率的な開発を支援します。

## 目次

1. [仕様管理の概要](#仕様管理の概要)
2. [ディレクトリ構造](#ディレクトリ構造)
3. [要件定義書](#要件定義書)
4. [設計書](#設計書)
5. [実装仕様書](#実装仕様書)
6. [テンプレートの使用方法](#テンプレートの使用方法)
7. [Claude Codeとの連携](#claude-codeとの連携)

## 仕様管理の概要

### 目的
- ワークフローの要件から実装まで一元管理
- 開発履歴の追跡と変更管理
- Claude Codeでの自動化促進
- チーム間での知識共有

### 文書化のメリット
- **開発効率の向上**: Claude Codeが仕様を理解して適切なコードを生成
- **保守性の確保**: 仕様変更時の影響範囲を明確化
- **品質向上**: 設計段階での問題発見とレビュー
- **知識の継承**: 属人化を防ぎ、チーム全体での理解促進

## ディレクトリ構造

```
workflows/specifications/
├── requirements/           # 要件定義書
│   ├── REQ-001_slack-notification.md
│   ├── REQ-002_data-sync.md
│   └── REQ-XXX_workflow-name.md
├── designs/               # 設計書
│   ├── DES-001_slack-notification.md
│   ├── DES-002_data-sync.md
│   └── DES-XXX_workflow-name.md
└── implementations/       # 実装仕様書
    ├── IMP-001_slack-notification.md
    ├── IMP-002_data-sync.md
    └── IMP-XXX_workflow-name.md
```

### ファイル命名規則
- **要件定義書**: `REQ-[連番]_[ワークフロー名].md`
- **設計書**: `DES-[連番]_[ワークフロー名].md`
- **実装仕様書**: `IMP-[連番]_[ワークフロー名].md`

## 要件定義書

### テンプレート
```markdown
# 要件定義書: [ワークフロー名]

## 基本情報
- **文書ID**: REQ-XXX
- **作成日**: YYYY-MM-DD
- **作成者**: [作成者名]
- **最終更新**: YYYY-MM-DD
- **ステータス**: [Draft/Review/Approved/Implemented]

## 1. 概要
### 1.1 目的
[このワークフローの目的と背景]

### 1.2 スコープ
[対象範囲と対象外の明確化]

## 2. 機能要件
### 2.1 主要機能
- [機能1の説明]
- [機能2の説明]

### 2.2 入力仕様
- **データソース**: [入力元]
- **データ形式**: [JSON/CSV/XML等]
- **必須項目**: [必須フィールド一覧]
- **任意項目**: [任意フィールド一覧]

### 2.3 出力仕様
- **出力先**: [出力先システム]
- **出力形式**: [形式の詳細]
- **出力タイミング**: [即時/バッチ/スケジュール]

## 3. 非機能要件
### 3.1 パフォーマンス
- **処理時間**: [許容される処理時間]
- **同時実行数**: [並列処理の要件]
- **データ量**: [想定データ量]

### 3.2 可用性
- **稼働時間**: [稼働時間の要件]
- **復旧時間**: [障害時の復旧目標]

### 3.3 セキュリティ
- **認証**: [認証要件]
- **データ保護**: [機密データの取り扱い]

## 4. ビジネスルール
- [ビジネスルール1]
- [ビジネスルール2]

## 5. 制約事項
- [技術的制約]
- [運用上の制約]

## 6. 関連システム
| システム名 | 役割 | インタフェース |
|-----------|------|---------------|
| [システム1] | [役割] | [API/DB/File等] |

## 7. 承認記録
| 日付 | 承認者 | 承認内容 |
|------|--------|----------|
| YYYY-MM-DD | [承認者名] | [承認内容] |
```

### Claude Code用プロンプト例
```
以下の要件定義書に基づいてn8nワークフローを作成してください：
[要件定義書の内容をペースト]

特に以下の点を考慮してください：
- 入力データのバリデーション
- エラーハンドリング
- ログ出力
- パフォーマンス要件
```

## 設計書

### テンプレート
```markdown
# 設計書: [ワークフロー名]

## 基本情報
- **文書ID**: DES-XXX
- **要件定義ID**: REQ-XXX
- **作成日**: YYYY-MM-DD
- **作成者**: [作成者名]
- **最終更新**: YYYY-MM-DD

## 1. アーキテクチャ設計
### 1.1 全体構成
[ワークフロー全体の構成図]

### 1.2 ノード構成
| ノード名 | タイプ | 役割 | 設定概要 |
|---------|--------|------|----------|
| [ノード1] | [HTTP Request/Function等] | [役割] | [設定の概要] |

## 2. データフロー設計
### 2.1 データ変換
```mermaid
graph LR
    A[入力データ] --> B[変換処理1]
    B --> C[変換処理2]
    C --> D[出力データ]
```

### 2.2 データマッピング
| 入力フィールド | 出力フィールド | 変換ルール |
|---------------|---------------|------------|
| [input_field1] | [output_field1] | [変換内容] |

## 3. エラーハンドリング設計
### 3.1 エラーパターン
- **HTTP Error**: [対処方法]
- **Data Validation Error**: [対処方法]
- **System Error**: [対処方法]

### 3.2 リトライ戦略
- **対象エラー**: [リトライ対象]
- **リトライ回数**: [最大回数]
- **リトライ間隔**: [間隔の設定]

## 4. セキュリティ設計
### 4.1 認証設定
- **認証方式**: [Bearer Token/API Key等]
- **クレデンシャル管理**: [環境変数/n8n credentials]

### 4.2 データ保護
- **暗号化**: [暗号化の要件]
- **ログマスキング**: [機密データのマスキング]

## 5. パフォーマンス設計
### 5.1 最適化方針
- **並列処理**: [並列化の方針]
- **バッチ処理**: [バッチサイズの設定]

## 6. テスト設計
### 6.1 テストシナリオ
- **正常系**: [正常なデータフローのテスト]
- **異常系**: [エラーケースのテスト]

## 7. 運用設計
### 7.1 監視項目
- **成功率**: [監視閾値]
- **処理時間**: [監視閾値]
- **エラー率**: [監視閾値]

### 7.2 ログ設計
- **ログレベル**: [INFO/WARN/ERROR等]
- **ログ出力先**: [ファイル/外部システム]
```

## 実装仕様書

### テンプレート
```markdown
# 実装仕様書: [ワークフロー名]

## 基本情報
- **文書ID**: IMP-XXX
- **設計書ID**: DES-XXX
- **作成日**: YYYY-MM-DD
- **実装者**: [実装者名]
- **実装完了日**: YYYY-MM-DD

## 1. 実装概要
### 1.1 ワークフローファイル
- **ファイル名**: `[workflow-name].json`
- **保存場所**: `workflows/[environment]/`
- **バージョン**: [バージョン番号]

## 2. ノード実装詳細
### 2.1 [ノード名1]
```json
{
  "name": "ノード名",
  "type": "n8n-nodes-base.httpRequest",
  "parameters": {
    "url": "https://api.example.com/endpoint",
    "authentication": "predefinedCredentialType",
    "nodeCredentialType": "slackApi"
  }
}
```

#### 設定パラメータ
- **URL**: [エンドポイントの詳細]
- **認証**: [認証設定の詳細]
- **ヘッダー**: [必要なヘッダー]

### 2.2 [ノード名2]
[同様の形式で各ノードの実装詳細]

## 3. 環境固有設定
### 3.1 開発環境
```json
{
  "N8N_ENVIRONMENT": "development",
  "API_BASE_URL": "https://dev-api.example.com",
  "LOG_LEVEL": "debug"
}
```

### 3.2 本番環境
```json
{
  "N8N_ENVIRONMENT": "production",
  "API_BASE_URL": "https://api.example.com",
  "LOG_LEVEL": "info"
}
```

## 4. テスト結果
### 4.1 単体テスト
| テストケース | 結果 | 実行日 | 備考 |
|-------------|------|--------|------|
| [テスト1] | Pass | YYYY-MM-DD | [備考] |

### 4.2 統合テスト
| シナリオ | 結果 | 実行日 | 備考 |
|---------|------|--------|------|
| [シナリオ1] | Pass | YYYY-MM-DD | [備考] |

## 5. デプロイ手順
1. [手順1]
2. [手順2]
3. [手順3]

## 6. 運用注意事項
- [注意事項1]
- [注意事項2]

## 7. 既知の問題
| 問題 | 影響度 | 対応予定 |
|------|--------|----------|
| [問題1] | [High/Medium/Low] | [対応予定日] |
```

## テンプレートの使用方法

### 1. 新規ワークフロー作成時
```bash
# テンプレートをコピー
cp templates/specifications/requirement-template.md workflows/specifications/requirements/REQ-001_new-workflow.md

# Claude Codeで要件定義書を作成
claude "以下の要求に基づいて要件定義書を作成してください: [要求内容]"
```

### 2. 設計フェーズ
```bash
# 要件定義書から設計書を生成
claude "REQ-001の要件定義書に基づいて設計書を作成してください"
```

### 3. 実装フェーズ
```bash
# 設計書からワークフローを実装
claude "DES-001の設計書に基づいてn8nワークフローを実装してください"
```

## Claude Codeとの連携

### 効果的なプロンプト例

#### 要件から直接実装
```
以下の要件でn8nワークフローを作成し、同時に仕様書も生成してください：

要件：
[具体的な要件]

出力：
1. 要件定義書（REQ-XXX形式）
2. 設計書（DES-XXX形式）
3. n8nワークフローJSON
4. 実装仕様書（IMP-XXX形式）
```

#### 既存仕様の更新
```
以下の仕様書を更新し、ワークフローも修正してください：

現在の仕様書：
[既存の仕様書内容]

変更要求：
[変更内容]

更新箇所：
1. 要件定義書の更新
2. 設計書の修正
3. ワークフローの実装変更
4. テストケースの追加
```

### 自動化スクリプト例

#### 仕様書テンプレート生成
```bash
#!/bin/bash
# generate-spec.sh

WORKFLOW_NAME=$1
SPEC_ID=$2

# テンプレートから新規仕様書を生成
sed "s/XXX/${SPEC_ID}/g; s/\[ワークフロー名\]/${WORKFLOW_NAME}/g" \
  templates/specifications/requirement-template.md > \
  workflows/specifications/requirements/REQ-${SPEC_ID}_${WORKFLOW_NAME}.md

echo "仕様書テンプレートを生成しました: REQ-${SPEC_ID}_${WORKFLOW_NAME}.md"
```

## ベストプラクティス

### 1. 文書の一貫性
- 統一されたテンプレートの使用
- 命名規則の厳守
- バージョン管理の徹底

### 2. Claude Codeの活用
- 仕様書を詳細に記述してコード生成精度を向上
- 段階的な開発プロセスの採用
- レビューとフィードバックの反映

### 3. 保守性の確保
- 定期的な仕様書の見直し
- 実装との整合性チェック
- 変更履歴の記録

## 参考リンク

- [n8nワークフロー開発ガイド](./n8n-workflow-guide.md)
- [Claude Codeコマンドテンプレート](./claude-commands.md)
- [セットアップ手順](./setup.md)